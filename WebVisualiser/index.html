<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    
    <title>Demo</title>

<!--    <meta name="viewport" content="width=device-width, initial-scale=1">-->
    <script src="zenid-visualizer.js" type="text/javascript"></script>

    <style type="text/css">
        .camera-preview {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }
        .camera-preview canvas {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="camera-preview">
<canvas></canvas>

<script type="text/javascript">
    // Create a visualizer with options
    const visualizer = new Visualizer({
        // Let Zenid draw the feedback text. Set to false if we want to display feedback ourselves.
        drawText: false
        // See https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/font for font syntax.
        //font: "24px sans-serif"
    });
    
    window.lastTimestamp = -1;
    
    function setup() {
        var width = window.innerWidth;
        var height = window.innerHeight;
        var canvas = document.getElementsByTagName("canvas")[0]
        canvas.width = width;
        canvas.height = height;
        canvas.setAttribute("style", "position: fixed; top:0; left:0; ");
        // transform:matrix(0.50,0.00,0.00,0.50,-187.5,-301.5);
    }

    var filterStrength = 20;
    var frameTime = 0, lastLoop = new Date, thisLoop;

    function countFrame(){
      var thisFrameTime = (thisLoop=new Date) - lastLoop;
      frameTime+= (thisFrameTime - frameTime) / filterStrength;
      lastLoop = thisLoop;
    }
    
    setInterval(function(){
      var fps = (1000/frameTime).toFixed(1) + " fps";
      var canvas = document.getElementsByTagName("canvas")[0]
      canvas.setAttribute("data-fps", fps);
    }, 1000);
    
    function drawCommands(renderCommands) {
        countFrame()
        var renderCommands = renderCommands.replace("\\n", "");
        var ageMs = 0;

        if (window.lastTimestamp != null) {
            ageMs = Date.now() - window.lastTimestamp;
        }
        const canvas = document.getElementsByTagName("canvas")[0]
        
        visualizer.drawOverlay(canvas, ageMs, renderCommands);
        window.lastTimestamp = Date.now();
    }
    
    setup();
</script>
</body>
</html>
